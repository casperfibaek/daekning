"use strict";function searchAll(e,t,r){dawa.autocomplete("postnumre",e,function(e,a){if(e)throw new Error(e);for(var n=0;n<a.length;n+=1){var o=document.createElement("li");o.className="result",o.setAttribute("type","postnummer"),o.setAttribute("externalID",a[n].postnummer.nr);var s=document.createElement("p");s.className="resultText",s.innerHTML=a[n].postnummer.navn+" ("+a[n].postnummer.nr+")";var i=document.createElement("p");i.className="resultIcon",i.innerHTML="(Postnummer)",o.appendChild(s),o.appendChild(i),o.addEventListener("click",r),t.appendChild(o)}}),dawa.autocomplete("adgangsadresser",e,function(e,a){if(e)throw new Error(e);for(var n=0;n<a.length;n+=1){var o=document.createElement("li");o.className="result",o.setAttribute("type","adgangsadresser"),o.setAttribute("externalID",a[n].adgangsadresse.href);var s=document.createElement("p");s.className="resultText",s.innerHTML=a[n].tekst;var i=document.createElement("p");i.className="resultIcon",i.innerHTML="Adresse",o.appendChild(s),o.appendChild(i),o.addEventListener("click",r),t.appendChild(o)}}),dawa.autocomplete("kommuner",e,function(e,a){if(e)throw new Error(e);for(var n=0;n<a.length;n+=1){var o=document.createElement("li");o.className="result",o.setAttribute("type","kommuner"),o.setAttribute("externalID",a[n].kommune.kode);var s=document.createElement("p");s.className="resultText",s.innerHTML=a[n].kommune.navn;var i=document.createElement("p");i.className="resultIcon",i.innerHTML="(Kommune)",o.appendChild(s),o.appendChild(i),o.addEventListener("click",r),t.appendChild(o)}}),dawa.autocomplete("supplerendebynavne",e,function(e,a){if(e)throw new Error(e);for(var n=0;n<a.length;n+=1){var o=document.createElement("li");o.className="result",o.setAttribute("type","supplerendebynavne"),o.setAttribute("externalID",a[n].supplerendebynavn.href);var s=document.createElement("p");s.className="resultText",s.innerHTML=a[n].supplerendebynavn.navn;var i=document.createElement("p");i.className="resultIcon",i.innerHTML="(Sup. Bynavn)",o.appendChild(s),o.appendChild(i),o.addEventListener("click",r),t.appendChild(o)}})}function kmsGeom(e,t,r,a){var n="https://services.kortforsyningen.dk/service?servicename=dagi_gml2&request=GetFeature&service=WFS&typeNames=kms:"+e+"&version=1.1.1&login=NirasINMA&password=75utag55&srsName=4326&filter=<Filter xmlns='http://www.opengis.net/ogc'><And><PropertyIsEqualTo><PropertyName>"+t+"</PropertyName><Literal>"+r+"</Literal></PropertyIsEqualTo></And></Filter>",o=new XMLHttpRequest;o.open("GET",n),o.send(null),o.onreadystatechange=function(){if(4===o.readyState)if(200===o.status){for(var e=(new DOMParser).parseFromString(o.responseText,"text/xml").getElementsByTagName("geometri"),t=[],r=0;r<e.length;r+=1){for(var n=[],s=e[r].getElementsByTagName("coordinates")[0].innerHTML.split(" "),i=0;i<s.length;i+=1){var l=s[i].split(",").splice(0,2).reverse();n.push([Number(l[0]),Number(l[1])])}t.push(n)}for(var d={type:"FeatureCollection",features:[]},m=0;m<t.length;m+=1)d.features.push({type:"Feature",geometry:{type:"Polygon",coordinates:[t[m]]}});a(!1,d)}else a(!0,"Error getting featureInfo (status: "+o.status+")")}}function getGeom(e,t,r){if("kommuner"===e)kmsGeom("KOMMUNE2000","CPR_noegle",t,function(e,t){if(e)throw new Error(e);var a=L.geoJSON(t,{style:{fillOpacity:0,dashArray:"10, 5"}}).addTo(map);for(map.flyToBounds(a.getBounds(),{maxZoom:15});r.firstChild;)r.removeChild(r.firstChild)});else if("postnummer"===e)kmsGeom("POSTDISTRIKT2000","PostCodeToID",t,function(e,t){if(e)throw new Error(e);var a=L.geoJSON(t,{style:{fillOpacity:0,dashArray:"10, 5"}}).addTo(map);for(map.flyToBounds(a.getBounds(),{maxZoom:15});r.firstChild;)r.removeChild(r.firstChild)});else if("adgangsadresser"===e){var a=new XMLHttpRequest;a.open("GET",t),a.send(null),a.onerror=function(){throw new Error("Error getting address information.")},a.onreadystatechange=function(){if(4===a.readyState){if(200!==a.status)throw new Error(t+" replied: "+a.status);try{var e=JSON.parse(a.responseText).adgangspunkt.koordinater.reverse();for(map.flyToBounds(L.latLng(e).toBounds(100),{maxZoom:15});r.firstChild;)r.removeChild(r.firstChild)}catch(e){throw new Error("Error parsing DAWA JSON.")}}}}else{if("supplerendebynavne"!==e)throw new Error("Could not understand request.");var n=new XMLHttpRequest;n.open("GET",t),n.send(null),n.onerror=function(){throw new Error("Error getting city name information.")},n.onreadystatechange=function(){if(4===n.readyState){if(200!==n.status)throw new Error(t+" replied: "+n.status);try{kmsGeom("POSTDISTRIKT2000","PostCodeToID",JSON.parse(n.responseText).postnumre[0].nr,function(e,t){if(e)throw new Error(e);var a=L.geoJSON(t,{style:{fillOpacity:0,dashArray:"10, 5"}});for(map.flyToBounds(a.getBounds(),{maxZoom:15});r.firstChild;)r.removeChild(r.firstChild)})}catch(e){throw new Error("Error parsing DAWA JSON.")}}}}}var _config={opdateret:"August 2017",layers:[{name:"3G4G_speed_outdoor_all_MapTiler",text:"Udenfor alle",image:null,default:!0},{name:"3G4G_speed_outdoor_200Mbit_MapTiler",text:"Udenfor 100-200 mbits/s",image:"css/images/Speed_100_200Mbit.png",default:!1},{name:"3G4G_speed_outdoor_100Mbit_MapTiler",text:"Udenfor 50-100 mbits/s",image:"css/images/Speed_50_100Mbit.png",default:!1},{name:"3G4G_speed_outdoor_50mbit_Maptiler",text:"Udenfor 30-50 mbits/s",image:"css/images/Speed_30_50Mbit.png",default:!1},{name:"G4G_speed_outdoor_30mbit_MapTiler",text:"Udenfor 20-30 mbits/s",image:"css/images/Speed_20_30Mbit.png",default:!1},{name:"3G4G_speed_outdoor_20mbit_MapTiler",text:"Udenfor 10-20 mbits/s",image:"css/images/Speed_10_20Mbit.png",default:!1},{name:"3G4G_speed_outdoor_10mbit_MapTiler",text:"Udenfor 5-10 mbits/s",image:"css/images/Speed_5_10Mbit.png",default:!1},{name:"3G4G_speed_outdoor_5mbit_MapTiler",text:"Udenfor 2-5 mbits/s",image:"css/images/Speed_2_5Mbit.png",default:!1}]},map=L.map("map",{zoomControl:!1,doubleClickZoom:!1,maxZoom:19,minZoom:7}).setView([56.17919,10.53588],7);L.control.layers({OpenStreetMap:L.tileLayer("http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19,edgeBufferTiles:2,updateWhenIdle:!1,attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'}),"OpenStreetMap BW":L.tileLayer("http://{s}.tiles.wmflabs.org/bw-mapnik/{z}/{x}/{y}.png",{maxZoom:19,edgeBufferTiles:2,updateWhenIdle:!1,attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'}).addTo(map),Flyfoto:L.tileLayer.wms("http://kortforsyningen.kms.dk/service?servicename=orto_foraar&client=QGIS&request=GetCapabilities&service=WMS&version=1.1.1&LOGIN=qgisdk&PASSWORD=qgisdk",{maxZoom:19,edgeBufferTiles:2,updateWhenIdle:!1,layers:"orto_foraar"})},{},{collapsed:!1,position:"topleft"}).addTo(map),L.control.zoom({position:"bottomright"}).addTo(map),L.control.scale({position:"bottomleft",imperial:!1,metric:!0}).addTo(map),L.Control.UpdateMsg=L.Control.extend({onAdd:function(){var e=L.DomUtil.create("div");return e.innerHTML="Sidst opdateret: "+_config.opdateret,e.classList.add("updateMessage"),e}}),L.control.UpdateMsg=function(e){return new L.Control.UpdateMsg(e)},L.control.UpdateMsg({position:"bottomleft"}).addTo(map),map.on("zoomanim",function(e){e.zoom>e.target._zoom?document.getElementsByClassName("leaflet-control-zoom-in")[0].style.background="#555":document.getElementsByClassName("leaflet-control-zoom-out")[0].style.background="#555"}).on("zoomend",function(){document.getElementsByClassName("leaflet-control-zoom-in")[0].style.background="#333",document.getElementsByClassName("leaflet-control-zoom-out")[0].style.background="#333"}).on("click",function(e){var t=e.latlng.lat,r=e.latlng.lng,a="http://daekning.telia.dk/TelNetMap_Main_Tile/Default/GetWmsFeatureInfo?wmsUrl="+encodeURIComponent("http://81.236.57.77/telnetmap_ext_services/kortinfo/Services/WMS.ashx?page=TeleWMS&Site=TS_DK&SERVICE=WMS&VERSION=1.3.0&REQUEST=GetFeatureInfo&WIDTH=1&HEIGHT=1&INFO_FORMAT=text/xml&X=0&Y=0&srs=EPSG:4326&QUERY_LAYERS=16549&BBOX=")+r+","+t+","+r+","+t+"&layerType=MapTiles&systems=LTE%2CUMTS&usages=OD",n=new XMLHttpRequest;n.open("GET",a),n.send(null),n.onreadystatechange=function(){if(4===n.readyState)if(200===n.status){for(var t=JSON.parse(n.responseText),r="<table>",a=0;a<t.length;a+=1)r+="<tr>",r+='<td class="table-title">'+t[a].split(":")[0]+"</td>",r+="<td>"+t[a].split(":")[1]+"</td>",r+="</tr>";r+="</table>",t.length>0&&L.popup().setLatLng(e.latlng).setContent(r).openOn(map)}else console.log("Error getting featureInfo (status: "+n.status+")")}});var init=function(){!function(e){var t=new XMLHttpRequest;t.open("GET","http://daekning.telia.dk/TelNetMap_Main_Tile/Default/GenerateTicket"),t.send(null),t.onreadystatechange=function(){if(4===t.readyState)if(200===t.status){var r=t.responseText;e(r)}else console.log("Error getting ticket (status: "+t.status+")")}}(function(e){for(var t=L.control.layers({},{},{collapsed:!1,position:"topright"}).addTo(map),r=L.layerGroup(),a=0;a<_config.layers.length;a+=1){var n=null!==_config.layers[a].image?'<img src="'+_config.layers[a].image+'"/>':"";t.addBaseLayer(function(t,r,a){var n=L.tileLayer("http://81.236.57.77/Telnetmap_TileService/GetTile.ashx?Ticket="+e.replace(/"/g,"")+"&LayerName="+t+"&Level={z}&X={x}&Y={y}",{edgeBufferTiles:2,updateWhenIdle:!1,maxZoom:19,maxNativeZoom:14,minZoom:7});return!0===r&&n.addTo(map),a.addLayer(n),n}(_config.layers[a].name,_config.layers[a].default,r),n+"  "+_config.layers[a].text)}r.setZIndex(201),r.eachLayer(function(e){e.setOpacity(.5)})})};init();var dawa={autocomplete:function(e,t,r){var a="http://dawa.aws.dk/"+e+"/autocomplete?q="+t+"&noformat&per_side="+(arguments.length>3&&void 0!==arguments[3]?arguments[3]:3),n=new XMLHttpRequest;n.open("GET",a),n.send(null),n.onerror=function(e){r(e)},n.onreadystatechange=function(){if(4===n.readyState)if(200===n.status)try{var e=JSON.parse(n.responseText);r(!1,e)}catch(e){r("Error parsing DAWA JSON.")}else r("During the autocomplete routine the URL: "+a+" replied: "+n.status)}},geom:{_base:function(e,t,r){return"https://services.kortforsyningen.dk/service?servicename=dagi_gml2&request=GetFeature&service=WFS&typeNames=kms:"+e+"&version=1.1.1&login=NirasINMA&password=75utag55&srsName=4326&filter=<Filterxmlns='http://www.opengis.net/ogc'><And><PropertyIsEqualTo><PropertyName>"+t+"</PropertyName><Literal>"+r+"</Literal></PropertyIsEqualTo></And></Filter>"},postnummer:function(e){return this._base("POSTDISTRIKT2000","PostCodeToID",e)},kommuner:function(e){return this._base("KOMMUNE2000","CPR_noegle",e)}}},searchContainer=document.getElementById("searchContainer"),resultList=document.createElement("ul");resultList.id="resultsHolder";var searchInput=document.createElement("input");searchInput.type="text",searchInput.className="search-input",searchInput.placeholder="Søg efter adresser, kommuner mm.";var searchTimeout=void 0;searchInput.addEventListener("input",function(){for(clearTimeout(searchTimeout);resultList.firstChild;)resultList.removeChild(resultList.firstChild);searchInput.value.length>2&&(searchTimeout=setTimeout(function(){searchAll(searchInput.value,resultList,function(e){var t=e.target.attributes;getGeom(t.type.value,t.externalID.value,resultList)})},500))}),searchContainer.appendChild(searchInput),searchContainer.appendChild(resultList);