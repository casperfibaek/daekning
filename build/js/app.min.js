"use strict";var dawa=function(){function e(e,t,n){var a="http://dawa.aws.dk/"+e+"/autocomplete?q="+t+"&noformat&per_side="+(arguments.length>3&&void 0!==arguments[3]?arguments[3]:3),r=new XMLHttpRequest;r.open("GET",a),r.send(null),r.onreadystatechange=function(){if(4===r.readyState)if(200===r.status)try{var e=JSON.parse(r.responseText);0===e.length?n(!1,!1):n(!1,e)}catch(e){n("Error parsing DAWA JSON!",e)}else n("Autocomplete routine @"+a+" replied: "+r.status)}}function t(t,n,a,r){for(var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,s=0;s<n.length;s+=1)!function(s){e(n[s],t,function(e,t){if(e)throw Error(e);if(t)for(var o=0;o<t.length;o+=1){var i=document.createElement("p"),l=document.createElement("p"),d=document.createElement("li");d.className="result",d.setAttribute("type",n[s]),i.className="resultText",l.className="resultIcon","postnumre"===n[s]?(d.setAttribute("externalID",t[o].postnummer.nr),i.innerHTML=t[o].postnummer.navn+", "+t[o].postnummer.nr,l.innerHTML="..Postnummer"):"adgangsadresser"===n[s]?(i.innerHTML=t[o].tekst,d.setAttribute("externalID",t[o].adgangsadresse.href),l.innerHTML="..Adresse"):"kommuner"===n[s]?(i.innerHTML=t[o].kommune.navn,d.setAttribute("externalID",t[o].kommune.kode),l.innerHTML="..Kommune"):"supplerendebynavne"===n[s]&&(d.setAttribute("externalID",t[o].supplerendebynavn.href),l.innerHTML="..Bynavn",i.innerHTML=t[o].supplerendebynavn.navn),d.appendChild(i),d.appendChild(l),d.addEventListener("click",r),a.appendChild(d)}},o)}(s)}function n(e,t,n,a){var r="https://services.kortforsyningen.dk/service?servicename=dagi_gml2&request=GetFeature&service=WFS&typeNames=kms:"+e+"&version=1.1.1&login=NirasINMA&password=75utag55&srsName=4326&filter=<Filter xmlns='http://www.opengis.net/ogc'><And><PropertyIsEqualTo><PropertyName>"+t+"</PropertyName><Literal>"+n+"</Literal></PropertyIsEqualTo></And></Filter>",o=new XMLHttpRequest;o.open("GET",r),o.send(null),o.onerror=function(){throw new Error("Error getting geometry.")},o.onreadystatechange=function(){if(4===o.readyState)if(200===o.status)try{for(var e=o.responseText.split("gml:coordinates>"),t=[],n=[],r=1;r<e.length;r+=2)n.push(e[r]);n[n.length-1]=n[n.length-1].slice(0,-2);for(var s=0;s<n.length;s+=1){for(var i=[],l=n[s].split(" "),d=0;d<l.length;d+=1){var m=l[d].split(",");i.push([Number(m[1]),Number(m[0])])}t.push(i)}for(var p={type:"FeatureCollection",features:[]},c=0;c<t.length;c+=1)p.features.push({type:"Feature",geometry:{type:"Polygon",coordinates:[t[c]]}});a(!1,p)}catch(e){a("Error parsing geometry from kortforsyningen.")}else a("Error getting featureInfo (status: "+o.status+")")}}function a(map,e,t){var n=L.geoJSON(e,{style:t});map.once("moveend",function(){n.addTo(map)}),map.flyToBounds(n.getBounds(),{maxZoom:15})}function r(map,e,t){var n=e.adgangspunkt.koordinater.reverse(),a=L.circle(n,{radius:40,fillOpacity:t.fillOpacity,color:t.color});map.once("moveend",function(){a.addTo(map)}),map.flyToBounds(L.latLng(n).toBounds(40),{maxZoom:15})}function o(e){for(;e.firstChild;)e.removeChild(e.firstChild)}function s(map){map.eachLayer(function(e){e instanceof L.Path&&map.removeLayer(e)})}function i(e,t,s,map,i){if("kommuner"===e)n("KOMMUNE2000","CPR_noegle",t,function(e,t){if(e)throw Error(e);a(map,t,i),o(s)});else if("postnumre"===e)n("POSTDISTRIKT2000","PostCodeToID",t,function(e,t){if(e)throw Error(e);a(map,t,i),o(s)});else if("adgangsadresser"===e){var l=new XMLHttpRequest;l.open("GET",t),l.send(null),l.onerror=function(){throw new Error("Error getting address information.")},l.onreadystatechange=function(){if(4===l.readyState){if(200!==l.status)throw Error(t+" replied: "+l.status);try{var e=JSON.parse(l.responseText);r(map,e,i),o(s)}catch(e){throw Error("Error parsing DAWA JSON.")}}}}else{if("supplerendebynavne"!==e)throw Error("Could not understand request.");var d=new XMLHttpRequest;d.open("GET",t),d.send(null),d.onreadystatechange=function(){if(4===d.readyState){if(200!==d.status)throw Error(t+" replied: "+d.status);try{n("POSTDISTRIKT2000","PostCodeToID",JSON.parse(d.responseText).postnumre[0].nr,function(e,t){if(e)throw Error(e);a(map,t,i),o(s)})}catch(e){throw Error("Error parsing DAWA JSON.")}}}}}var l={themes:["postnumre","adgangsadresser","kommuner","supplerendebynavne"],replies:3,style:{fillOpacity:0,dashArray:"10, 5",color:"#f2932f"}};return function(map,e){if(!map||!L)throw Error("Leaflet not defined.");var n=document.getElementById(e),a=document.createElement("ul"),r=document.createElement("input");a.id="resultsHolder",r.type="search",r.className="search-input",r.setAttribute("aria-label","search"),r.placeholder="Søg efter adresser, kommuner mm.";var d=void 0;r.addEventListener("input",function(){clearTimeout(d),o(a),s(map),r.value.length>2&&(d=setTimeout(function(){t(r.value,l.themes,a,function(e){var t=e.target.attributes;i(t.type.value,t.externalID.value,a,map,l.style)},l.replies)},500))}),n.appendChild(r),n.appendChild(a),window.onkeydown=function(e){if(r===document.activeElement){var t=e.keyCode?e.keyCode:e.which;if(27===t&&(r.value="",o(a)),0!==a.children.length)if(40===t||38===t){var n=document.getElementsByClassName("result selected");if(0===n.length)a.firstChild.classList.add("selected");else{for(var s=void 0,i=0;i<a.children.length;i+=1)if(a.children[i].classList.contains("selected")){s=i;break}var l=document.getElementsByClassName("result").length;40===t?s!==l-1&&(n[0].classList.remove("selected"),a.children[s+1].classList.add("selected")):0!==s&&(n[0].classList.remove("selected"),a.children[s-1].classList.add("selected"))}}else if(13===t){var d=document.getElementsByClassName("result selected");0!==d.length&&(r.value=d[0].firstChild.innerHTML,d[0].click(),o(a))}}}}}(),config={opdateret:"August 2017",connections:{ticket:"http://daekning.telia.dk/TelNetMap_Main_Tile/Default/GenerateTicket",tiles:"http://81.236.57.77/Telnetmap_TileService/GetTile.ashx?",feature:"http://daekning.telia.dk/TelNetMap_Main_Tile/Default/GetWmsFeatureInfo?wmsUrl=",featureOptions:"http://81.236.57.77/telnetmap_ext_services/kortinfo/Services/WMS.ashx?page=TeleWMS&Site=TS_DK&SERVICE=WMS&VERSION=1.3.0&REQUEST=GetFeatureInfo&WIDTH=1&HEIGHT=1&INFO_FORMAT=text/xml&X=0&Y=0&srs=EPSG:4326&QUERY_LAYERS=16549&BBOX="},layerGroups:[{layername:"Datahastighed - Udendørs",defaultOpen:!0,layers:[{name:"3G4G_speed_outdoor_all_MapTiler",text:"Udenfor alle",image:!1,default:!0},{name:"3G4G_speed_outdoor_200Mbit_MapTiler",text:"Udenfor 100-200 mbits/s",image:"css/images/telia/Speed_100_200Mbit.png"},{name:"3G4G_speed_outdoor_100Mbit_MapTiler",text:"Udenfor 50-100 mbits/s",image:"css/images/telia/Speed_50_100Mbit.png"},{name:"3G4G_speed_outdoor_50mbit_Maptiler",text:"Udenfor 30-50 mbits/s",image:"css/images/telia/Speed_30_50Mbit.png"},{name:"3G4G_speed_outdoor_30mbit_MapTiler",text:"Udenfor 20-30 mbits/s",image:"css/images/telia/Speed_20_30Mbit.png"},{name:"3G4G_speed_outdoor_20mbit_MapTiler",text:"Udenfor 10-20 mbits/s",image:"css/images/telia/Speed_10_20Mbit.png"},{name:"3G4G_speed_outdoor_10mbit_MapTiler",text:"Udenfor 5-10 mbits/s",image:"css/images/telia/Speed_5_10Mbit.png"},{name:"3G4G_speed_outdoor_5mbit_MapTiler",text:"Udenfor 2-5 mbits/s",image:"css/images/telia/Speed_2_5Mbit.png"}]},{layername:"Datahastighed - Indendørs",layers:[{name:"3G4G_speed_indoor_all_MapTiler",text:"Indenfor alle",image:!1},{name:"3G4G_speed_indoor_200Mbit_MapTiler",text:"Indenfor 100-200 mbits/s",image:"css/images/telia/Speed_100_200Mbit.png"},{name:"3G4G_speed_indoor_100Mbit_MapTiler",text:"Indenfor 50-100 mbits/s",image:"css/images/telia/Speed_50_100Mbit.png"},{name:"3G4G_speed_indoor_50mbit_Maptiler",text:"Indenfor 30-50 mbits/s",image:"css/images/telia/Speed_30_50Mbit.png"},{name:"3G4G_speed_indoor_30mbit_MapTiler",text:"Indenfor 20-30 mbits/s",image:"css/images/telia/Speed_20_30Mbit.png"},{name:"3G4G_speed_indoor_20mbit_MapTiler",text:"Indenfor 10-20 mbits/s",image:"css/images/telia/Speed_10_20Mbit.png"},{name:"3G4G_speed_indoor_10mbit_MapTiler",text:"Indenfor 5-10 mbits/s",image:"css/images/telia/Speed_5_10Mbit.png"},{name:"3G4G_speed_indoor_5mbit_MapTiler",text:"Indenfor 2-5 mbits/s",image:"css/images/telia/Speed_2_5Mbit.png"}]},{layername:"Teknologi - Udendørs",layers:[{name:"All_outdoor_MapTiler",text:"Udenfor alle",image:!1},{name:"4G_outdoor_Maptiler",text:"4G Udenfor",image:"css/images/telia/Speed_100_200Mbit.png"},{name:"3G_outdoor_Maptiler",text:"3G Udenfor",image:"css/images/telia/Speed_20_30Mbit.png"},{name:"2G_outdoor_Maptiler",text:"2G Udenfor",image:"css/images/telia/Speed_2_5Mbit.png"}]},{layername:"Teknologi - Indendørs",layers:[{name:"All_indoor_MapTiler",text:"Indenfor alle",image:!1},{name:"4G_outdoor_Maptiler",text:"4G Indenfor",image:"css/images/telia/Speed_100_200Mbit.png"},{name:"3G_outdoor_Maptiler",text:"3G Indenfor",image:"css/images/telia/Speed_20_30Mbit.png"},{name:"2G_outdoor_Maptiler",text:"2G Indenfor",image:"css/images/telia/Speed_2_5Mbit.png"}]},{layername:"Tale",layers:[{name:"tele_outdoor_tale",text:"Telefon udenfor",image:"css/images/telia/Speed_20_30Mbit.png"},{name:"tele_indoor_tale",text:"Telefon indenfor",image:"css/images/telia/Speed_20_30Mbit.png"}]}]},niras={getTicket:function(e,config){var t=new XMLHttpRequest;t.open("GET",config.connections.ticket),t.send(null),t.onreadystatechange=function(){4===t.readyState&&(200===t.status?e(!1,t.responseText.replace(/"/g,"")):e("Error getting ticket (status: "+t.status+")"))}},getTiles:function(e,t,config){return L.tileLayer(config.connections.tiles+"Ticket="+e+"&LayerName="+t+"&Level={z}&X={x}&Y={y}",{maxZoom:19,maxNativeZoom:14,minZoom:7})},getFeatureInfo:function(e,t,config){var n=e.latlng.lat,a=e.latlng.lng,r=""+config.connections.feature+encodeURIComponent(config.connections.featureOptions)+a+","+n+","+a+","+n+"&layerType=MapTiles&systems=LTE%2CUMTS&usages=OD",o=new XMLHttpRequest;o.open("GET",r),o.send(null),o.onreadystatechange=function(){if(4===o.readyState&&200===o.status)try{var e=JSON.parse(o.responseText);if(e.length>1){for(var n="<table>",a=0;a<e.length;a+=1)n+="<tr>",n+='<td class="table-title">'+e[a].split(":")[0]+"</td>",n+="<td>"+e[a].split(":")[1]+"</td>",n+="</tr>";t(!1,n+="</table>")}else t(!1,!1)}catch(e){t(Error("Error parsing JSON data, "+e))}}}},layerControl=function(map,e,config,t,n){L.Control.CustomControl=L.Control.extend({onAdd:function(){return L.DomUtil.create("div")}});var a=new L.Control.CustomControl({position:"topright"}).addTo(map).getContainer();L.DomEvent.disableClickPropagation(a),a.classList.add("legend");for(var r=0;r<config.layerGroups.length;r+=1)!function(r){var o=document.createElement("div");o.classList.add("legendGroupContainer");var s=config.layerGroups[r],i=document.createElement("h4");i.innerHTML=s.layername,i.classList.add("legendHeading"),s.defaultOpen?(o.classList.add("open"),i.classList.add("open")):o.style.maxHeight="28px",o.appendChild(i);for(var l=0;l<s.layers.length;l+=1)!function(a){var r=document.createElement("div"),i=document.createElement("IMG"),l=document.createElement("p"),d=n(t,s.layers[a].name,config);s.layers[a].default&&(e.addLayer(d),r.classList.add("selected")),r.classList.add("legendElement"),r.addEventListener("click",function(){if(!r.classList.contains("selected")){for(var t=document.querySelectorAll(".selected,.legendElement"),n=0;n<t.length;n+=1)t[n].classList.remove("selected");r.classList.add("selected"),e.eachLayer(function(t){e.removeLayer(t)}),e.addLayer(d),e.setZIndex(201)}}),i.src=s.layers[a].image?s.layers[a].image:"css/images/Transparent.png",i.alt=s.layers[a].text,i.classList.add("legendImage"),l.classList.add("legendText"),l.innerHTML=s.layers[a].text,r.appendChild(i),r.appendChild(l),o.appendChild(r)}(l);a.appendChild(o),s.defaultOpen&&(o.style.maxHeight=o.offsetHeight+"px"),i.addEventListener("click",function(){if(o.classList.contains("open")){var e=window.getComputedStyle(i),t=Number(e.marginTop.substring(0,e.marginTop.length-2));o.style.maxHeight=18+t+"px",i.classList.remove("open"),o.classList.remove("open")}else o.style.maxHeight=o.scrollHeight+"px",o.classList.add("open"),i.classList.add("open")})}(r)},opacityControl=function(map,e){function t(){d=parseFloat(window.getComputedStyle(l).left),m=l.getBoundingClientRect().left-d}function n(t,n){t.preventDefault();var a=t.clientX?t.clientX:t.touches[0].clientX,r=void 0;(r=n?a-i.getBoundingClientRect().left:a-m)>s?r=s:r<0&&(r=0),l.style.left=r+"px",e.eachLayer(function(e){e.setOpacity(r/s)})}function a(){e.eachLayer(function(e){e.setOpacity(parseFloat(window.getComputedStyle(l).left)/s)})}function r(){document.removeEventListener("mousemove",n),document.removeEventListener("mouseup",r),document.removeEventListener("touchmove",n),document.removeEventListener("touchend",r)}function o(e){n(e,"clicked"),document.addEventListener("mousemove",n),document.addEventListener("touchmove",n),document.addEventListener("touchend",r),document.addEventListener("mouseup",r)}var s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:200;L.Control.OpacityControl=L.Control.extend({onAdd:function(){return L.DomUtil.create("div")}});var i=new L.Control.OpacityControl({position:"topright"}).addTo(map).getContainer();L.DomEvent.disableClickPropagation(i),i.classList.add("opacityControl");var l=document.createElement("div");l.classList.add("circleSelector"),i.appendChild(l);var d=parseFloat(window.getComputedStyle(l).left),m=l.getBoundingClientRect().left-d,p=void 0;return window.onresize=function(){clearTimeout(p),p=setTimeout(t,s)},map.on("layeradd",function(){a()}),i.addEventListener("mousedown",o),i.addEventListener("touchstart",o),l.addEventListener("mousedown",function(){document.addEventListener("mousemove",n),document.addEventListener("mouseup",r)}),l.addEventListener("touchstart",function(){document.addEventListener("touchmove",n),document.addEventListener("touchend",r)}),a(),opacityControl},map=L.map("map",{zoomControl:!1,doubleClickZoom:!1,maxZoom:16,minZoom:7}).setView([56.23,11.25],7);L.tileLayer("http://{s}.basemaps.cartocdn.com/light_nolabels/{z}/{x}/{y}.png",{attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> &copy; <a href="http://cartodb.com/attributions">CartoDB</a>',subdomains:"abcd",maxZoom:19}).addTo(map).setZIndex(150),L.tileLayer("http://{s}.basemaps.cartocdn.com/light_only_labels/{z}/{x}/{y}.png",{attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> &copy; <a href="http://cartodb.com/attributions">CartoDB</a>',subdomains:"abcd",maxZoom:19}).addTo(map).setZIndex(400),L.control.layers({Baggroundskort:L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:16,attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'}),"Baggroundskort sort/hvid":L.tileLayer("http://{s}.tiles.wmflabs.org/bw-mapnik/{z}/{x}/{y}.png",{maxZoom:16,attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>'}),Flyfoto:L.tileLayer.wms("https://kortforsyningen.kms.dk/service?servicename=orto_foraar&client=QGIS&request=GetCapabilities&service=WMS&version=1.1.1&LOGIN=NirasINMA&PASSWORD=75utag55",{maxZoom:16,layers:"orto_foraar"}),"Flyfoto sort/hvid":L.tileLayer.wms("http://services.nirasmap.niras.dk/kortinfo/services/Wms.ashx?Site=NirasInternKort&Page=KI-Basis&Service=WMS&Version=1.1.1&service=WMS&layers=B346&format=image/png&srs=EPSG:3857&Request=getmap",{maxZoom:16})},{},{collapsed:!0,position:"topleft"}).addTo(map),L.control.scale({position:"bottomleft",imperial:!1,metric:!0}).addTo(map),L.Control.UpdateMsg=L.Control.extend({onAdd:function(){var e=L.DomUtil.create("div");return L.DomEvent.disableClickPropagation(e),e.innerHTML="Sidst opdateret: "+config.opdateret,e.classList.add("updateMessage"),e}}),new L.Control.UpdateMsg({position:"bottomleft"}).addTo(map),map.on("click",function(e){niras.getFeatureInfo(e,function(t,n){if(t)throw Error(t);n&&L.popup().setLatLng(e.latlng).setContent(n).openOn(map)},config)}),niras.getTicket(function(e,t){if(e)throw Error(e);if(0!==config.layerGroups.length){var n=L.layerGroup().addTo(map);dawa(map,"searchBar",200),layerControl(map,n,config,t,niras.getTiles),opacityControl(map,n),n.setZIndex(201)}},config);