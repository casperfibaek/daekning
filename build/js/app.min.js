"use strict";var dawa=function(){function e(e,t,n){var a="http://dawa.aws.dk/"+e+"/autocomplete?q="+t+"&noformat&per_side="+(arguments.length>3&&void 0!==arguments[3]?arguments[3]:3),o=new XMLHttpRequest;o.open("GET",a),o.send(null),o.onreadystatechange=function(){if(4===o.readyState)if(200===o.status)try{var e=JSON.parse(o.responseText);0===e.length?n(!1,!1):n(!1,e)}catch(e){n("Error parsing DAWA JSON!",e)}else n("Autocomplete routine @"+a+" replied: "+o.status)}}function t(t,n,a,o){for(var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,i=0;i<n.length;i+=1)!function(i){e(n[i],t,function(e,t){if(e)throw Error(e);if(t)for(var r=0;r<t.length;r+=1){var s=document.createElement("p"),l=document.createElement("p"),d=document.createElement("li");d.className="result",d.setAttribute("type",n[i]),s.className="resultText",l.className="resultIcon","postnumre"===n[i]?(d.setAttribute("externalID",t[r].postnummer.nr),s.innerHTML=t[r].postnummer.navn+", "+t[r].postnummer.nr,l.innerHTML="..Postnummer"):"adgangsadresser"===n[i]?(s.innerHTML=t[r].tekst,d.setAttribute("externalID",t[r].adgangsadresse.href),l.innerHTML="..Adresse"):"kommuner"===n[i]?(s.innerHTML=t[r].kommune.navn,d.setAttribute("externalID",t[r].kommune.kode),l.innerHTML="..Kommune"):"supplerendebynavne"===n[i]&&(d.setAttribute("externalID",t[r].supplerendebynavn.href),l.innerHTML="..Bynavn",s.innerHTML=t[r].supplerendebynavn.navn),d.appendChild(s),d.appendChild(l),d.addEventListener("click",o),a.appendChild(d)}},r)}(i)}function n(e,t,n,a){var o="https://services.kortforsyningen.dk/service?servicename=dagi_gml2&request=GetFeature&service=WFS&typeNames=kms:"+e+"&version=1.1.1&login=NirasINMA&password=75utag55&srsName=4326&filter=<Filter xmlns='http://www.opengis.net/ogc'><And><PropertyIsEqualTo><PropertyName>"+t+"</PropertyName><Literal>"+n+"</Literal></PropertyIsEqualTo></And></Filter>",r=new XMLHttpRequest;r.open("GET",o),r.send(null),r.onerror=function(){throw new Error("Error getting geometry.")},r.onreadystatechange=function(){if(4===r.readyState)if(200===r.status)try{for(var e=r.responseText.split("gml:coordinates>"),t=[],n=[],o=1;o<e.length;o+=2)n.push(e[o]);n[n.length-1]=n[n.length-1].slice(0,-2);for(var i=0;i<n.length;i+=1){for(var s=[],l=n[i].split(" "),d=0;d<l.length;d+=1){var c=l[d].split(",");s.push([Number(c[1]),Number(c[0])])}t.push(s)}for(var m={type:"FeatureCollection",features:[]},p=0;p<t.length;p+=1)m.features.push({type:"Feature",geometry:{type:"Polygon",coordinates:[t[p]]}});a(!1,m)}catch(e){a("Error parsing geometry from kortforsyningen.")}else a("Error getting featureInfo (status: "+r.status+")")}}function a(map,e,t){var n=L.geoJSON(e,{style:t});map.once("moveend",function(){n.addTo(map)}),map.flyToBounds(n.getBounds(),{maxZoom:15})}function o(map,e,t){var n=e.adgangspunkt.koordinater.reverse(),a=L.circle(n,{radius:40,fillOpacity:t.fillOpacity,color:t.color});map.once("moveend",function(){a.addTo(map)}),map.flyToBounds(L.latLng(n).toBounds(40),{maxZoom:15})}function r(e){for(;e.firstChild;)e.removeChild(e.firstChild)}function i(map){map.eachLayer(function(e){e instanceof L.Path&&map.removeLayer(e)})}function s(e,t,i,map,s){if("kommuner"===e)n("KOMMUNE2000","CPR_noegle",t,function(e,t){if(e)throw Error(e);a(map,t,s),r(i)});else if("postnumre"===e)n("POSTDISTRIKT2000","PostCodeToID",t,function(e,t){if(e)throw Error(e);a(map,t,s),r(i)});else if("adgangsadresser"===e){var l=new XMLHttpRequest;l.open("GET",t),l.send(null),l.onerror=function(){throw new Error("Error getting address information.")},l.onreadystatechange=function(){if(4===l.readyState){if(200!==l.status)throw Error(t+" replied: "+l.status);try{var e=JSON.parse(l.responseText);o(map,e,s),r(i)}catch(e){throw Error("Error parsing DAWA JSON.")}}}}else{if("supplerendebynavne"!==e)throw Error("Could not understand request.");var d=new XMLHttpRequest;d.open("GET",t),d.send(null),d.onreadystatechange=function(){if(4===d.readyState){if(200!==d.status)throw Error(t+" replied: "+d.status);try{n("POSTDISTRIKT2000","PostCodeToID",JSON.parse(d.responseText).postnumre[0].nr,function(e,t){if(e)throw Error(e);a(map,t,s),r(i)})}catch(e){throw Error("Error parsing DAWA JSON.")}}}}}var l={themes:["postnumre","adgangsadresser","kommuner","supplerendebynavne"],replies:3,style:{fillOpacity:0,dashArray:"10, 5",color:"#f2932f"}};return function(map,e){if(!map||!L)throw Error("Leaflet not defined.");var n=document.getElementById(e),a=document.createElement("ul"),o=document.createElement("input");a.id="resultsHolder",o.type="search",o.className="search-input",o.setAttribute("aria-label","search"),o.placeholder="Søg efter adresser, kommuner mm.";var d=void 0;o.addEventListener("input",function(){clearTimeout(d),r(a),i(map),o.value.length>2&&(d=setTimeout(function(){t(o.value,l.themes,a,function(e){var t=e.target.attributes;s(t.type.value,t.externalID.value,a,map,l.style)},l.replies)},500))}),n.appendChild(o),n.appendChild(a),window.onkeydown=function(e){if(o===document.activeElement){var t=e.keyCode?e.keyCode:e.which;if(27===t&&(o.value="",r(a)),0!==a.children.length)if(40===t||38===t){var n=document.getElementsByClassName("result selected");if(0===n.length)a.firstChild.classList.add("selected");else{for(var i=void 0,s=0;s<a.children.length;s+=1)if(a.children[s].classList.contains("selected")){i=s;break}var l=document.getElementsByClassName("result").length;40===t?i!==l-1&&(n[0].classList.remove("selected"),a.children[i+1].classList.add("selected")):0!==i&&(n[0].classList.remove("selected"),a.children[i-1].classList.add("selected"))}}else if(13===t){var d=document.getElementsByClassName("result selected");0!==d.length&&(o.value=d[0].firstChild.innerHTML,d[0].click(),r(a))}}}}}(),config={opdateret:"August 2017",connections:{ticket:"http://daekning.telia.dk/TelNetMap_Main_Tile/Default/GenerateTicket",tiles:"http://81.236.57.77/Telnetmap_TileService/GetTile.ashx?",feature:"http://daekning.telia.dk/TelNetMap_Main_Tile/Default/GetWmsFeatureInfo?wmsUrl=",featureOptions:"http://81.236.57.77/telnetmap_ext_services/kortinfo/Services/WMS.ashx?page=TeleWMS&Site=TS_DK&SERVICE=WMS&VERSION=1.3.0&REQUEST=GetFeatureInfo&WIDTH=1&HEIGHT=1&INFO_FORMAT=text/xml&X=0&Y=0&srs=EPSG:4326&QUERY_LAYERS=16549&BBOX="},layerGroups:[{layername:"Datahastighed - Udendørs",defaultOpen:!0,layers:[{name:"3G4G_speed_outdoor_all_MapTiler",text:"Udenfor alle",image:!1,default:!0},{name:"3G4G_speed_outdoor_200Mbit_MapTiler",text:"Udenfor 100-200 mbits/s",image:"css/images/telia/Speed_100_200Mbit.png"},{name:"3G4G_speed_outdoor_100Mbit_MapTiler",text:"Udenfor 50-100 mbits/s",image:"css/images/telia/Speed_50_100Mbit.png"},{name:"3G4G_speed_outdoor_50mbit_Maptiler",text:"Udenfor 30-50 mbits/s",image:"css/images/telia/Speed_30_50Mbit.png"},{name:"3G4G_speed_outdoor_30mbit_MapTiler",text:"Udenfor 20-30 mbits/s",image:"css/images/telia/Speed_20_30Mbit.png"},{name:"3G4G_speed_outdoor_20mbit_MapTiler",text:"Udenfor 10-20 mbits/s",image:"css/images/telia/Speed_10_20Mbit.png"},{name:"3G4G_speed_outdoor_10mbit_MapTiler",text:"Udenfor 5-10 mbits/s",image:"css/images/telia/Speed_5_10Mbit.png"},{name:"3G4G_speed_outdoor_5mbit_MapTiler",text:"Udenfor 2-5 mbits/s",image:"css/images/telia/Speed_2_5Mbit.png"}]},{layername:"Datahastighed - Indendørs",layers:[{name:"3G4G_speed_indoor_all_MapTiler",text:"Indenfor alle",image:!1},{name:"3G4G_speed_indoor_200Mbit_MapTiler",text:"Indenfor 100-200 mbits/s",image:"css/images/telia/Speed_100_200Mbit.png"},{name:"3G4G_speed_indoor_100Mbit_MapTiler",text:"Indenfor 50-100 mbits/s",image:"css/images/telia/Speed_50_100Mbit.png"},{name:"3G4G_speed_indoor_50mbit_Maptiler",text:"Indenfor 30-50 mbits/s",image:"css/images/telia/Speed_30_50Mbit.png"},{name:"3G4G_speed_indoor_30mbit_MapTiler",text:"Indenfor 20-30 mbits/s",image:"css/images/telia/Speed_20_30Mbit.png"},{name:"3G4G_speed_indoor_20mbit_MapTiler",text:"Indenfor 10-20 mbits/s",image:"css/images/telia/Speed_10_20Mbit.png"},{name:"3G4G_speed_indoor_10mbit_MapTiler",text:"Indenfor 5-10 mbits/s",image:"css/images/telia/Speed_5_10Mbit.png"},{name:"3G4G_speed_indoor_5mbit_MapTiler",text:"Indenfor 2-5 mbits/s",image:"css/images/telia/Speed_2_5Mbit.png"}]},{layername:"Teknologi - Udendørs",layers:[{name:"All_outdoor_MapTiler",text:"Udenfor alle",image:!1},{name:"4G_outdoor_Maptiler",text:"4G Udenfor",image:"css/images/telia/Speed_100_200Mbit.png"},{name:"3G_outdoor_Maptiler",text:"3G Udenfor",image:"css/images/telia/Speed_20_30Mbit.png"},{name:"2G_outdoor_Maptiler",text:"2G Udenfor",image:"css/images/telia/Speed_2_5Mbit.png"}]},{layername:"Teknologi - Indendørs",layers:[{name:"All_indoor_MapTiler",text:"Indenfor alle",image:!1},{name:"4G_outdoor_Maptiler",text:"4G Indenfor",image:"css/images/telia/Speed_100_200Mbit.png"},{name:"3G_outdoor_Maptiler",text:"3G Indenfor",image:"css/images/telia/Speed_20_30Mbit.png"},{name:"2G_outdoor_Maptiler",text:"2G Indenfor",image:"css/images/telia/Speed_2_5Mbit.png"}]},{layername:"Tale",layers:[{name:"tele_outdoor_tale",text:"Telefon udenfor",image:"css/images/telia/Speed_20_30Mbit.png"},{name:"tele_indoor_tale",text:"Telefon indenfor",image:"css/images/telia/Speed_20_30Mbit.png"}]}]},niras={getTicket:function(e,config){var t=new XMLHttpRequest;t.open("GET",config.connections.ticket),t.send(null),t.onreadystatechange=function(){4===t.readyState&&(200===t.status?e(!1,t.responseText.replace(/"/g,"")):e("Error getting ticket (status: "+t.status+")"))}},getTiles:function(e,t,config){return L.tileLayer(config.connections.tiles+"Ticket="+e+"&LayerName="+t+"&Level={z}&X={x}&Y={y}",{maxZoom:19,maxNativeZoom:14,minZoom:7})},getFeatureInfo:function(e,t,config){var n=e.latlng.lat,a=e.latlng.lng,o=""+config.connections.feature+encodeURIComponent(config.connections.featureOptions)+a+","+n+","+a+","+n+"&layerType=MapTiles&systems=LTE%2CUMTS&usages=OD",r=new XMLHttpRequest;r.open("GET",o),r.send(null),r.onreadystatechange=function(){if(4===r.readyState&&200===r.status)try{var e=JSON.parse(r.responseText);if(e.length>1){for(var n="<table>",a=0;a<e.length;a+=1)n+="<tr>",n+='<td class="table-title">'+e[a].split(":")[0]+"</td>",n+="<td>"+e[a].split(":")[1]+"</td>",n+="</tr>";t(!1,n+="</table>")}else t(!1,!1)}catch(e){t(Error("Error parsing JSON data, "+e))}}}},layerControl=function(map,e,config,t,n){L.Control.CustomControl=L.Control.extend({onAdd:function(){return L.DomUtil.create("div")}});var a=new L.Control.CustomControl({position:"topright"}).addTo(map).getContainer();L.DomEvent.disableClickPropagation(a),a.classList.add("legend");for(var o=0;o<config.layerGroups.length;o+=1)!function(o){var r=document.createElement("div");r.classList.add("legendGroupContainer");var i=config.layerGroups[o],s=document.createElement("h4");s.innerHTML=i.layername,s.classList.add("legendHeading"),i.defaultOpen?(r.classList.add("open"),s.classList.add("open")):r.style.maxHeight="28px",r.appendChild(s);for(var l=0;l<i.layers.length;l+=1)!function(a){var o=document.createElement("div"),s=document.createElement("IMG"),l=document.createElement("p"),d=n(t,i.layers[a].name,config);i.layers[a].default&&(e.addLayer(d),o.classList.add("selected")),o.classList.add("legendElement"),o.addEventListener("click",function(){if(!o.classList.contains("selected")){for(var t=document.querySelectorAll(".selected,.legendElement"),n=0;n<t.length;n+=1)t[n].classList.remove("selected");o.classList.add("selected"),e.eachLayer(function(t){e.removeLayer(t)}),e.addLayer(d),e.setZIndex(201)}}),s.src=i.layers[a].image?i.layers[a].image:"css/images/Transparent.png",s.alt=i.layers[a].text,s.classList.add("legendImage"),l.classList.add("legendText"),l.innerHTML=i.layers[a].text,o.appendChild(s),o.appendChild(l),r.appendChild(o)}(l);a.appendChild(r),i.defaultOpen&&(r.style.maxHeight=r.offsetHeight+"px"),s.addEventListener("click",function(){if(r.classList.contains("open")){var e=window.getComputedStyle(s),t=Number(e.marginTop.substring(0,e.marginTop.length-2));r.style.maxHeight=18+t+"px",s.classList.remove("open"),r.classList.remove("open")}else r.style.maxHeight=r.scrollHeight+"px",r.classList.add("open"),s.classList.add("open")})}(o)},opacityControl=function(map,e){function t(){d=parseFloat(window.getComputedStyle(l).left),c=l.getBoundingClientRect().left-d}function n(t,n){t.preventDefault();var a=t.clientX?t.clientX:t.touches[0].clientX,o=void 0;(o=n?a-s.getBoundingClientRect().left:a-c)>i?o=i:o<0&&(o=0),l.style.left=o+"px",e.eachLayer(function(e){e.setOpacity(o/i)})}function a(){e.eachLayer(function(e){e.setOpacity(parseFloat(window.getComputedStyle(l).left)/i)})}function o(){document.removeEventListener("mousemove",n),document.removeEventListener("mouseup",o),document.removeEventListener("touchmove",n),document.removeEventListener("touchend",o)}function r(e){n(e,"clicked"),document.addEventListener("mousemove",n),document.addEventListener("touchmove",n),document.addEventListener("touchend",o),document.addEventListener("mouseup",o)}var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:200;L.Control.OpacityControl=L.Control.extend({onAdd:function(){return L.DomUtil.create("div")}});var s=new L.Control.OpacityControl({position:"topright"}).addTo(map).getContainer();L.DomEvent.disableClickPropagation(s),s.classList.add("opacityControl");var l=document.createElement("div");l.classList.add("circleSelector"),s.appendChild(l);var d=parseFloat(window.getComputedStyle(l).left),c=l.getBoundingClientRect().left-d,m=void 0;return window.onresize=function(){clearTimeout(m),m=setTimeout(t,i)},map.on("layeradd",function(){a()}),s.addEventListener("mousedown",r),s.addEventListener("touchstart",r),l.addEventListener("mousedown",function(){document.addEventListener("mousemove",n),document.addEventListener("mouseup",o)}),l.addEventListener("touchstart",function(){document.addEventListener("touchmove",n),document.addEventListener("touchend",o)}),a(),opacityControl},map=L.map("map",{zoomControl:!1,doubleClickZoom:!1,maxZoom:16,minZoom:7}).setView([56.23,11.25],7);L.tileLayer("http://{s}.basemaps.cartocdn.com/light_nolabels/{z}/{x}/{y}.png",{attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> &copy; <a href="http://cartodb.com/attributions">CartoDB</a>',subdomains:"abcd",maxZoom:19}).addTo(map).setZIndex(150),L.tileLayer("http://{s}.basemaps.cartocdn.com/light_only_labels/{z}/{x}/{y}.png",{attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> &copy; <a href="http://cartodb.com/attributions">CartoDB</a>',subdomains:"abcd",maxZoom:19}).addTo(map).setZIndex(400),L.control.scale({position:"bottomleft",imperial:!1,metric:!0}).addTo(map),L.Control.UpdateMsg=L.Control.extend({onAdd:function(){var e=L.DomUtil.create("div");return L.DomEvent.disableClickPropagation(e),e.innerHTML="Sidst opdateret: "+config.opdateret,e.classList.add("updateMessage"),e}}),new L.Control.UpdateMsg({position:"bottomleft"}).addTo(map),map.on("click",function(e){niras.getFeatureInfo(e,function(t,n){if(t)throw Error(t);n&&L.popup().setLatLng(e.latlng).setContent(n).openOn(map)},config)}),niras.getTicket(function(e,t){if(e)throw Error(e);if(0!==config.layerGroups.length){var n=L.layerGroup().addTo(map);dawa(map,"searchBar",200),layerControl(map,n,config,t,niras.getTiles),opacityControl(map,n),n.setZIndex(201)}},config);