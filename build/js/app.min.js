"use strict";var _config={opdateret:"August 2017",layers:[{name:"3G4G_speed_outdoor_all_MapTiler",text:"Udenfor alle",image:null,default:!0},{name:"3G4G_speed_outdoor_200Mbit_MapTiler",text:"Udenfor 100-200 mbits/s",image:"css/images/Speed_100_200Mbit.png"},{name:"3G4G_speed_outdoor_100Mbit_MapTiler",text:"Udenfor 50-100 mbits/s",image:"css/images/Speed_50_100Mbit.png"},{name:"3G4G_speed_outdoor_50mbit_Maptiler",text:"Udenfor 30-50 mbits/s",image:"css/images/Speed_30_50Mbit.png"},{name:"G4G_speed_outdoor_30mbit_MapTiler",text:"Udenfor 20-30 mbits/s",image:"css/images/Speed_20_30Mbit.png"},{name:"3G4G_speed_outdoor_20mbit_MapTiler",text:"Udenfor 10-20 mbits/s",image:"css/images/Speed_10_20Mbit.png"},{name:"3G4G_speed_outdoor_10mbit_MapTiler",text:"Udenfor 5-10 mbits/s",image:"css/images/Speed_5_10Mbit.png"},{name:"3G4G_speed_outdoor_5mbit_MapTiler",text:"Udenfor 2-5 mbits/s",image:"css/images/Speed_2_5Mbit.png"}]},dawa=function(){function e(e,t,r){var n="http://dawa.aws.dk/"+e+"/autocomplete?q="+t+"&noformat&per_side="+(arguments.length>3&&void 0!==arguments[3]?arguments[3]:3),o=new XMLHttpRequest;o.open("GET",n),o.send(null),o.onerror=function(e){r(e)},o.onreadystatechange=function(){if(4===o.readyState)if(200===o.status)try{var e=JSON.parse(o.responseText);r(!1,e)}catch(e){r("Error parsing DAWA JSON.")}else r("During the autocomplete routine the URL: "+n+" replied: "+o.status)}}function t(t,r,n,o){for(var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,s=0;s<r.length;s+=1)!function(s){e(r[s],t,function(e,t){if(e)throw Error(e);var a=document.createElement("li");a.className="result",a.setAttribute("type",r[s]);var i=document.createElement("p");i.className="resultText","postnummer"===r[s]?(a.setAttribute("externalID",t[s].postnummer.nr),i.innerHTML=t[s].postnummer.navn+" ("+t[s].postnummer.nr+")"):"adgangsadresser"===r[s]?(i.innerHTML=t[s].tekst,a.setAttribute("externalID",t[s].adgangsadresse.href)):"kommuner"===r[s]?(i.innerHTML=t[s].kommune.navn,a.setAttribute("externalID",t[s].kommune.kode)):"supplerendebynavne"===r[s]&&(a.setAttribute("externalID",t[s].supplerendebynavn.href),i.innerHTML=t[s].supplerendebynavn.navn);var l=document.createElement("p");l.className="resultIcon",l.innerHTML="("+r[s]+")",a.appendChild(i),a.appendChild(l),a.addEventListener("click",o),n.appendChild(a)},a)}(s)}function r(e,t,r,n){var o="https://services.kortforsyningen.dk/service?servicename=dagi_gml2&request=GetFeature&service=WFS&typeNames=kms:"+e+"&version=1.1.1&login=NirasINMA&password=75utag55&srsName=4326&filter=<Filter xmlns='http://www.opengis.net/ogc'><And><PropertyIsEqualTo><PropertyName>"+t+"</PropertyName><Literal>"+r+"</Literal></PropertyIsEqualTo></And></Filter>",a=new XMLHttpRequest;a.open("GET",o),a.send(null),a.onerror=function(){throw new Error("Error getting geometry.")},a.onreadystatechange=function(){if(4===a.readyState)if(200===a.status){for(var e=(new DOMParser).parseFromString(a.responseText,"text/xml").getElementsByTagName("geometri"),t=[],r=0;r<e.length;r+=1){for(var o=[],s=e[r].getElementsByTagName("coordinates")[0].innerHTML.split(" "),i=0;i<s.length;i+=1){var l=s[i].split(",").splice(0,2).reverse();o.push([Number(l[0]),Number(l[1])])}t.push(o)}for(var p={type:"FeatureCollection",features:[]},d=0;d<t.length;d+=1)p.features.push({type:"Feature",geometry:{type:"Polygon",coordinates:[t[d]]}});n(!1,p)}else n(!0,"Error getting featureInfo (status: "+a.status+")")}}function n(map,e){if(!L||!L.geoJSON)throw Error("No leaflet installation found.");var t=L.geoJSON(e,{style:{fillOpacity:0,dashArray:"10, 5"}}).addTo(map);map.flyToBounds(t.getBounds(),{maxZoom:15})}function o(map,e){var t=e.adgangspunkt.koordinater.reverse();map.flyToBounds(L.latLng(t).toBounds(100),{maxZoom:15})}function a(e){for(;e.firstChild;)e.removeChild(e.firstChild)}function s(map){map.eachLayer(function(e){e instanceof L.Path&&map.removeLayer(e)})}function i(e,t,s,map){if("kommuner"===e)r("KOMMUNE2000","CPR_noegle",t,function(e,t){if(e)throw Error(e);n(map,t),a(s)});else if("postnummer"===e)r("POSTDISTRIKT2000","PostCodeToID",t,function(e,t){if(e)throw Error(e);n(map,t),a(s)});else if("adgangsadresser"===e){var i=new XMLHttpRequest;i.open("GET",t),i.send(null),i.onerror=function(){throw new Error("Error getting address information.")},i.onreadystatechange=function(){if(4===i.readyState){if(200!==i.status)throw Error(t+" replied: "+i.status);try{o(JSON.parse(i.responseText)),a(s)}catch(e){throw Error("Error parsing DAWA JSON.")}}}}else{if("supplerendebynavne"!==e)throw Error("Could not understand request.");var l=new XMLHttpRequest;l.open("GET",t),l.send(null),l.onerror=function(){throw new Error("Error getting city name information.")},l.onreadystatechange=function(){if(4===l.readyState){if(200!==l.status)throw Error(t+" replied: "+l.status);try{r("POSTDISTRIKT2000","PostCodeToID",JSON.parse(l.responseText).postnumre[0].nr,function(e,t){if(e)throw Error(e);n(map,t),a(s)})}catch(e){throw Error("Error parsing DAWA JSON.")}}}}}var _config={themes:["postnumre","adgangsadresser","kommuner","supplerendebynavne"],replies:3};return function(e,map){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:_config;if(!map||!L)throw Error("Leaflet not defined.");var n=document.getElementById(e),o=document.createElement("ul");o.id="resultsHolder";var l=document.createElement("input");l.type="text",l.className="search-input",l.placeholder="SÃ¸g efter adresser, kommuner mm.";var p=void 0;l.addEventListener("input",function(){clearTimeout(p),a(o),s(map),l.value.length>2&&(p=setTimeout(function(){t(l.value,r.themes,o,function(e){var t=e.target.attributes;i(t.type.value,t.externalID.value,o,map)},r.replies)},500))}),n.appendChild(l),n.appendChild(o)}}(),map=L.map("map",{zoomControl:!1,doubleClickZoom:!1,maxZoom:19,minZoom:7}).setView([56.17919,10.53588],7);L.control.layers({OpenStreetMap:L.tileLayer("http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19,edgeBufferTiles:2,updateWhenIdle:!1,attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'}),"OpenStreetMap BW":L.tileLayer("http://{s}.tiles.wmflabs.org/bw-mapnik/{z}/{x}/{y}.png",{maxZoom:19,edgeBufferTiles:2,updateWhenIdle:!1,attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'}).addTo(map),Flyfoto:L.tileLayer.wms("http://kortforsyningen.kms.dk/service?servicename=orto_foraar&client=QGIS&request=GetCapabilities&service=WMS&version=1.1.1&LOGIN=qgisdk&PASSWORD=qgisdk",{maxZoom:19,edgeBufferTiles:2,updateWhenIdle:!1,layers:"orto_foraar"})},{},{collapsed:!1,position:"topleft"}).addTo(map),L.control.zoom({position:"bottomright"}).addTo(map),L.control.scale({position:"bottomleft",imperial:!1,metric:!0}).addTo(map),L.Control.UpdateMsg=L.Control.extend({onAdd:function(){var e=L.DomUtil.create("div");return e.innerHTML="Sidst opdateret: "+_config.opdateret,e.classList.add("updateMessage"),e}}),L.control.UpdateMsg=function(e){return new L.Control.UpdateMsg(e)},L.control.UpdateMsg({position:"bottomleft"}).addTo(map),map.on("zoomanim",function(e){e.zoom>e.target._zoom?document.getElementsByClassName("leaflet-control-zoom-in")[0].style.background="#555":document.getElementsByClassName("leaflet-control-zoom-out")[0].style.background="#555"}).on("zoomend",function(){document.getElementsByClassName("leaflet-control-zoom-in")[0].style.background="#333",document.getElementsByClassName("leaflet-control-zoom-out")[0].style.background="#333"}).on("click",function(e){var t=e.latlng.lat,r=e.latlng.lng,n="http://daekning.telia.dk/TelNetMap_Main_Tile/Default/GetWmsFeatureInfo?wmsUrl="+encodeURIComponent("http://81.236.57.77/telnetmap_ext_services/kortinfo/Services/WMS.ashx?page=TeleWMS&Site=TS_DK&SERVICE=WMS&VERSION=1.3.0&REQUEST=GetFeatureInfo&WIDTH=1&HEIGHT=1&INFO_FORMAT=text/xml&X=0&Y=0&srs=EPSG:4326&QUERY_LAYERS=16549&BBOX=")+r+","+t+","+r+","+t+"&layerType=MapTiles&systems=LTE%2CUMTS&usages=OD",o=new XMLHttpRequest;o.open("GET",n),o.send(null),o.onreadystatechange=function(){if(4===o.readyState)if(200===o.status){for(var t=JSON.parse(o.responseText),r="<table>",n=0;n<t.length;n+=1)r+="<tr>",r+='<td class="table-title">'+t[n].split(":")[0]+"</td>",r+="<td>"+t[n].split(":")[1]+"</td>",r+="</tr>";r+="</table>",t.length>0&&L.popup().setLatLng(e.latlng).setContent(r).openOn(map)}else console.log("Error getting featureInfo (status: "+o.status+")")}}),dawa("searchContainer",map);var getTicket=function(e){var t=new XMLHttpRequest;t.open("GET","http://daekning.telia.dk/TelNetMap_Main_Tile/Default/GenerateTicket"),t.send(null),t.onreadystatechange=function(){if(4===t.readyState)if(200===t.status){var r=t.responseText;e(r)}else console.log("Error getting ticket (status: "+t.status+")")}};getTicket(function(e){for(var t=L.control.layers({},{},{collapsed:!1,position:"topright"}).addTo(map),r=L.layerGroup(),n=0;n<_config.layers.length;n+=1){var o=null!==_config.layers[n].image?'<img src="'+_config.layers[n].image+'"/>':"";t.addBaseLayer(function(t,r){var n=L.tileLayer("http://81.236.57.77/Telnetmap_TileService/GetTile.ashx?Ticket="+e.replace(/"/g,"")+"&LayerName="+t.name+"&Level={z}&X={x}&Y={y}",{edgeBufferTiles:2,updateWhenIdle:!1,maxZoom:19,maxNativeZoom:14,minZoom:7});return t.default&&!0===t.default&&n.addTo(map),r.addLayer(n),n}(_config.layers[n],r),o+"  "+_config.layers[n].text)}r.setZIndex(201),r.eachLayer(function(e){e.setOpacity(.5)})});